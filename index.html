// ... existing code ...
function renderUserSelect() {
  const list = getEmployeeList();
  const row = document.getElementById('userSelectRow');
  let html = '<label>é¸æ“‡å“¡å·¥ï¼š</label>';
  html += '<select id="userSelect">';
  list.forEach((emp, idx) => {
    html += `<option value="${emp.tableId}">${emp.name}</option>`;
  });
  html += '<option value="__new__">+ æ–°å¢å“¡å·¥</option>';
  html += '</select>';
  html += '<input id="newUserInput" type="text" placeholder="è«‹è¼¸å…¥æ–°å“¡å·¥å§“å" style="display:none;" />';
  // æ–°å¢ï¼šç·¨è¼¯èˆ‡åˆªé™¤æŒ‰éˆ•
  html += '<button id="editEmployeeBtn" class="btn" style="padding:4px 14px;font-size:0.98em;vertical-align:middle;">âœï¸ ç·¨è¼¯å§“å</button>';
  html += '<button id="deleteEmployeeBtn" class="btn" style="padding:4px 14px;font-size:0.98em;background:linear-gradient(90deg,#e74c3c 60%,#c0392b 100%);margin-left:4px;vertical-align:middle;">ğŸ—‘ï¸ åˆªé™¤å“¡å·¥</button>';
  row.innerHTML = html;
  document.getElementById('userSelect').onchange = function() {
    if (this.value === '__new__') {
      document.getElementById('newUserInput').style.display = '';
    } else {
      document.getElementById('newUserInput').style.display = 'none';
      localStorage.setItem('selectedUser', this.value);
      renderEmployeeSchedule();
    }
  };
  document.getElementById('newUserInput').onchange = function() {
    const name = this.value.trim();
    if (!name) return;
    const list = getEmployeeList();
    const newId = 'table-' + Math.random().toString(36).slice(2,8);
    list.push({name, tableId: newId});
    saveEmployeeList(list);
    localStorage.setItem('selectedUser', newId);
    renderUserSelect();
    renderEmployeeSchedule();
  };
  // é è¨­é¸æ“‡
  const selectedUser = localStorage.getItem('selectedUser') || list[0].tableId;
  document.getElementById('userSelect').value = selectedUser;

  // ç·¨è¼¯å“¡å·¥å§“å
  document.getElementById('editEmployeeBtn').onclick = function() {
    const list = getEmployeeList();
    const selectedId = document.getElementById('userSelect').value;
    if (selectedId === '__new__') return;
    const emp = list.find(e => e.tableId === selectedId);
    if (!emp) return;
    const newName = prompt('è«‹è¼¸å…¥æ–°çš„å“¡å·¥å§“åï¼š', emp.name);
    if (newName && newName.trim() && newName !== emp.name) {
      emp.name = newName.trim();
      saveEmployeeList(list);
      renderUserSelect();
      renderEmployeeSchedule();
    }
  };
  // åˆªé™¤å“¡å·¥
  document.getElementById('deleteEmployeeBtn').onclick = function() {
    const list = getEmployeeList();
    const selectedId = document.getElementById('userSelect').value;
    if (selectedId === '__new__') return;
    const emp = list.find(e => e.tableId === selectedId);
    if (!emp) return;
    if (!confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${emp.name}ã€åŠå…¶æ‰€æœ‰è¡Œç¨‹è³‡æ–™å—ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚`)) return;
    // åˆªé™¤è¡Œç¨‹è³‡æ–™
    const weekKeys = Object.keys(localStorage).filter(k => k.startsWith(selectedId + '-'));
    weekKeys.forEach(k => localStorage.removeItem(k));
    // åˆªé™¤å“¡å·¥
    const newList = list.filter(e => e.tableId !== selectedId);
    saveEmployeeList(newList);
    // åˆ‡æ›åˆ°ç¬¬ä¸€ä½å“¡å·¥
    if (newList.length > 0) {
      localStorage.setItem('selectedUser', newList[0].tableId);
    } else {
      localStorage.removeItem('selectedUser');
    }
    renderUserSelect();
    renderEmployeeSchedule();
  };
}
// ... existing code ...